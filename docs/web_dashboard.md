# Web 仪表盘总览

全新的 Web 仪表盘为文物安全协同监控器提供了美观、灵活且可远程访问的管理端。界面以实时视频流为核心，配合多维指标、报警动画、音效提示和文物防护配置，帮助值守人员快速掌握当日与七日的安防态势。

## 功能亮点

- **实时视频流**：基于 MJPEG 推流，展示集成监控器渲染后的画面（含电子栅栏、姿态骨架、危险标注、提示卡片等）。
- **高亮报警体验**：新的报警以渐变卡片、光晕动画与 Web Audio 合成音效提示，清晰区分入侵、危险携带等事件。
- **统计面板**：仪表盘顶部展示累计报警、今日概览、七日趋势与实时性能，自动更新帧率与状态信息。
- **时间线与历史**：实时报警列表与历史时间线同步刷新，便于回顾近时段发生的事件。
- **文物防护配置**：侧边栏与底部卡片可远程一键纳入/移除保护对象，或针对单个检测目标进行切换。
- **多端自适应**：采用玻璃拟态风格与柔和动画，在桌面与平板视图下均保持良好体验。

## 启动方式

确保依赖已安装并准备好姿态/检测模型：

```bash
pip install -r requirements.txt
python WebcamPoseDetection/download_model.py
```

随后通过模块方式启动仪表盘：

```bash
python -m webapp.app
```

默认监听 `http://localhost:8000`，主要环境变量如下：

| 变量名 | 默认值 | 说明 |
| --- | --- | --- |
| `VIDEO_SOURCE` | `0` | 摄像头索引或视频文件路径 |
| `CONFIDENCE_THRESHOLD` | `0.25` | YOLOv7 目标检测置信度阈值 |

> 提示：仪表盘首次访问会自动尝试启动检测模型与姿态模型，如未提前下载会花费额外时间。

## 交互说明

- **实时报警流**：当有新报警时，卡片会伴随动画进入并播放提示音；声效首次播放需用户与页面交互以解锁音频上下文。
- **文物保护卡片**：点击卡片即可切换保护状态，保护中文物以绿色辉光标识；侧边栏按钮提供“一键保护全部”和“清空选择”。
- **性能面板**：当检测线程断开或帧率异常时，会在性能卡片下方显示状态提示。

## 结构概览

```
webapp/
├── app.py                # Flask 入口、路由与监控器初始化
├── __init__.py           # create_app 工厂方法导出
├── templates/
│   └── dashboard.html    # 主仪表盘页面
└── static/
    ├── css/dashboard.css # 玻璃拟态主题与动画样式
    └── js/dashboard.js   # 状态轮询、交互逻辑与音效触发
```

监控器核心逻辑位于 `object_protection/web_monitor.py`，其对 `IntegratedSafetyMonitor` 做了无窗口封装并维护 MJPEG 帧、报警日志、日/周统计等结构化数据，可扩展用于其他可视化方案。
